<?php


//50 5070 70100 100120 120
//$point[""] = "< 7|entre 7j et 1m|entre 1 et 4|> 4|<50|5080|80120|120150|150+";
$point = array();
$point["FM01A1N"] = "100|200|300|400|100|200|300|400|500";
$point["FM01B1N"] = "100|200|300|400|100|200|300|400|500";

$point["FM02A1N"] = "200|400|600|800|200|400|600|800|1000";
$point["FM02B1N"] = "200|400|600|800|200|400|600|800|1000";
$point["FM02C1N"] = "200|400|600|800|200|400|600|800|1000";
$point["FM02D1N"] = "200|400|600|800|200|400|600|800|1000";
$point["FM02E1N"] = "200|400|600|800|200|400|600|800|1000";
$point["FM02F1N"] = "200|400|600|800|200|400|600|800|1000";

$point["FM03A1D"] = "300|600|900|1200|300|600|900|1200|1500";
$point["FM03A1B"] = "300|600|900|1200|300|600|900|1200|1500";
$point["FM03A1A"] = "300|600|900|1200|300|600|900|1200|1500";
$point["FM03B1D"] = "300|600|900|1200|300|600|900|1200|1500";
$point["FM03B1B"] = "300|600|900|1200|300|600|900|1200|1500";
$point["FM03B1A"] = "300|600|900|1200|300|600|900|1200|1500";
$point["FM03C1D"] = "300|600|900|1200|300|600|900|1200|1500";
$point["FM03C1B"] = "300|600|900|1200|300|600|900|1200|1500";
$point["FM03C1A"] = "300|600|900|1200|300|600|900|1200|1500";
$point["FM03D1D"] = "300|600|900|1200|300|600|900|1200|1500";
$point["FM03D1B"] = "300|600|900|1200|300|600|900|1200|1500";
$point["FM03D1A"] = "300|600|900|1200|300|600|900|1200|1500";
$point["FM03E1D"] = "300|600|900|1200|300|600|900|1200|1500";
$point["FM03E1B"] = "300|600|900|1200|300|600|900|1200|1500";
$point["FM03E1A"] = "300|600|900|1200|300|600|900|1200|1500";
$point["FM03F1D"] = "300|600|900|1200|300|600|900|1200|1500";
$point["FM03F1B"] = "300|600|900|1200|300|600|900|1200|1500";
$point["FM03F1A"] = "300|600|900|1200|300|600|900|1200|1500";

$point["FM04A1D"] = "400|800|1200|1600|400|800|1200|1600|2000";
$point["FM04A1B"] = "400|800|1200|1600|400|800|1200|1600|2000";
$point["FM04A1A"] = "400|800|1200|1600|400|800|1200|1600|2000";
$point["FM04B1D"] = "400|800|1200|1600|400|800|1200|1600|2000";
$point["FM04B1B"] = "400|800|1200|1600|400|800|1200|1600|2000";
$point["FM04B1A"] = "400|800|1200|1600|400|800|1200|1600|2000";
$point["FM04C1D"] = "400|800|1200|1600|400|800|1200|1600|2000";
$point["FM04C1B"] = "400|800|1200|1600|400|800|1200|1600|2000";
$point["FM04C1A"] = "400|800|1200|1600|400|800|1200|1600|2000";
$point["FM04D1D"] = "400|800|1200|1600|400|800|1200|1600|2000";
$point["FM04D1B"] = "400|800|1200|1600|400|800|1200|1600|2000";
$point["FM04D1A"] = "400|800|1200|1600|400|800|1200|1600|2000";
$point["FM04E1D"] = "400|800|1200|1600|400|800|1200|1600|2000";
$point["FM04E1B"] = "400|800|1200|1600|400|800|1200|1600|2000";
$point["FM04E1A"] = "400|800|1200|1600|400|800|1200|1600|2000";
$point["FM04F1D"] = "400|800|1200|1600|400|800|1200|1600|2000";
$point["FM04F1B"] = "400|800|1200|1600|400|800|1200|1600|2000";
$point["FM04F1A"] = "400|800|1200|1600|400|800|1200|1600|2000";

$point["FM05A1D"] = "500|1000|1500|2000|500|1000|1500|2000|2500";
$point["FM05A1B"] = "500|1000|1500|2000|500|1000|1500|2000|2500";
$point["FM05A1A"] = "500|1000|1500|2000|500|1000|1500|2000|2500";
$point["FM05B1D"] = "500|1000|1500|2000|500|1000|1500|2000|2500";
$point["FM05B1B"] = "500|1000|1500|2000|500|1000|1500|2000|2500";
$point["FM05B1A"] = "500|1000|1500|2000|500|1000|1500|2000|2500";
$point["FM05C1D"] = "500|1000|1500|2000|500|1000|1500|2000|2500";
$point["FM05C1B"] = "500|1000|1500|2000|500|1000|1500|2000|2500";
$point["FM05C1A"] = "500|1000|1500|2000|500|1000|1500|2000|2500";
$point["FM06A1D"] = "600|1200|1800|2400|600|1200|1800|2400|3000";
$point["FM06A1B"] = "600|1200|1800|2400|600|1200|1800|2400|3000";
$point["FM06B1D"] = "600|1200|1800|2400|600|1200|1800|2400|3000";
$point["FM06B1B"] = "600|1200|1800|2400|600|1200|1800|2400|3000";
$point["FM06C1D"] = "600|1200|1800|2400|600|1200|1800|2400|3000";
$point["FM06C1B"] = "600|1200|1800|2400|600|1200|1800|2400|3000";
$point["FM06D1D"] = "600|1200|1800|2400|600|1200|1800|2400|3000";
$point["FM06D1B"] = "600|1200|1800|2400|600|1200|1800|2400|3000";


$levels = array();
//$levels[0] = "nb de points|cumul";
$levels[1] = "10000|10000";
$levels[2] = "11800|21800";
$levels[3] = "13600|35400";
$levels[4] = "15400|50800";
$levels[5] = "17200|68000";
$levels[6] = "19000|87000";
$levels[7] = "20800|107800";
$levels[8] = "22600|130400";
$levels[9] = "24400|154800";
$levels[10] = "26200|181000";
$levels[11] = "28000|209000";
$levels[12] = "29800|238800";
$levels[13] = "31600|270400";
$levels[14] = "33400|303800";
$levels[15] = "35200|339000";
$levels[16] = "37000|376000";
$levels[17] = "38800|414800";
$levels[18] = "40600|455400";
$levels[19] = "42400|497800";
$levels[20] = "44200|542000";
$levels[21] = "46000|588000";
$levels[22] = "47800|635800";
$levels[23] = "49600|685400";
$levels[24] = "51400|736800";
$levels[25] = "53200|790000";
$levels[26] = "55000|845000";
$levels[27] = "56800|901800";
$levels[28] = "58600|960400";
$levels[29] = "60400|1020800";
$levels[30] = "62200|1083000";


function levelSize($levels, $xp)
{

}


function pointsToAdd($point, $drillCode, $drillAchievement, $speed, $timeLevel)
{
  
  $pointsToAdd = 0;
  $pointsToCorrect = 0;
  $pct = 5; // pourcentage
  // on récupère les points du dril
  $points = $point[$drillCode];
  // on le split en un tableau
  $pointsTab = explode("|", $points);
  //on split le drill achirvement
  $daTab = str_split($drillAchievement);


  //echo "<br/>"."---SPEED--";
  
  // determine le niveau de la vitesse
  $lvl = setLevelFromSpeed($speed);
  //on en déduit ou est ce dans le tableau
  $lvl = intval($lvl) - 1; 
  $lvl = $lvl + 4;
  // ca donne le nbre d'xp lié: $pointsTab[$lvl];

  $wonPointsTab = array(); 

  //Gestion de la vitesse
  //on boucle pour ramasser les niveaux précédents
  for ($x = $lvl; $x >= 4; $x--) 
  {
    //si les points n'ont pas été pris
    if($daTab[$x] == "0")
    {
      //on ajoute les points au total
      $pointsToAdd = $pointsToAdd + intval($pointsTab[$x]);
      //echo "+".$pointsTab[$x]."=";
      //echo $pointsToAdd." ";
      //on met à jour le drill achievement
      $daTab[$x] = "1";
      $wonPointsTab[$x] = $pointsTab[$x];
    }

   $pointsToCorrect = $pointsToCorrect + (intval($pointsTab[$x]))*0.33;

 }

  //echo "<br/>"."---TIME--";

  // determine le niveau de temps
  //on en déduit ou est ce dans le tableau
 $lvl = intval($timeLevel) - 1; 

  // ca donne le nbre d'xp lié: $pointsTab[$lvl];

  //Gestion du temps
  //on boucle pour ramasser les niveaux précédents
 for ($x = $lvl; $x >= 0; $x--) 
 {
    //si les points n'ont pas été pris
  if($daTab[$x] == "0")
  {
      //on ajoute les points au total
    $pointsToAdd = $pointsToAdd + intval($pointsTab[$x]);
      //echo "+".$pointsTab[$x]."=";
      //echo $pointsToAdd." ";
      //on met à jour le drill achievement
    $daTab[$x] = "1";
    $wonPointsTab[$x] = $pointsTab[$x];
  }

 $pointsToCorrect = $pointsToCorrect + (intval($pointsTab[$x]))*0.33;

}

  //if($pointsToAdd == 0) $pointsToAdd = $pointsToCorrect;
  //recreer le drill achievement après modifs
$drillAchievementOut = $daTab[0].$daTab[1].$daTab[2].$daTab[3].$daTab[4].$daTab[5].$daTab[6].$daTab[7].$daTab[8];
//echo "<br/>".$drillAchievement." devient ".$drillAchievementOut."<br/>";

$ret = array();
$ret["drillAchievementOut"] = $drillAchievementOut;
$ret["points"] = $pointsToAdd;
$ret["pointsTab"] = $wonPointsTab;
$ret["pointsToCorrect"] = $pointsToCorrect;
$ret["msg"] = "<br/>".$pointsToAdd."-".$drillAchievementOut;
return $ret;

}

//0010 01000
//"< 7|entre 7j et 1m|entre 1 et 4|> 4|<50|5080|80120|120150|150+"/
// 0         0             1        0 | 0   1    0      1     0


?>